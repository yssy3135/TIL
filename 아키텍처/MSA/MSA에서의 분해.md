# MSA 에서의 분해

### 분해 → 비즈니스 능력(Business Capability) 기준으로 서비스를 정의하는 일

### 왜 분해/통합이 어려울까?

- MSA에서 분리/분해의 의미는 ‘Business Capability를 가질 수 있는 방향으로 서비스를 정의하는일’ → 통합이 될 수 도 있다.
- 수 많은 복잡한 비즈니스가 있는 시스템에서 각 서비스가 Business Capability를 최대한 가질 수 있도록 ‘적절하게’ 서비스를 정의하는 일
- 각 서비스 별로 하나의 DB를 가진다는 관점에서, 각 서비스 간 적절한 관계를 통해 Business Capability 확보하는 것이 관건이다.

### 어떤 기준에 따라서? 어떤 지침에 따라서? 분리/분해/통합 하면 좋을지 Business Capability를 가질 수 있을까?

비즈니스 동작 / 하위 도메인 패턴이 그 수단이 될 수 있다.

### 어떤 기준이 있을까?

**비즈니스 동작 기준으로 분리**

사용자(액터) 입장에서의 비즈니스 요청 식별 ‘비즈니스 동작’ 자체를 각 서비스로 분리.

배달 주문 시스템의 예)

‘주문 서비스’ - 고객 입장

특정 음식점의 음식들을 주문할 수 있다.

‘주문 관리 서비스’ - 음식점 입장

접수된 주문에 대해서 승낙/거부 등의 처리를 할 수 있다.

‘배달 서비스’ - 회사 입장

승낙 처리된 주문에 대해서 적절한 배달원과 주문과 매칭시킬 수 있다.

**비즈니스 동작을 기준으로 분리할 경우**

**장점**

비즈니스 동작이 그 자체만으로 매우 중요하거나 복잡하고 혹은 비즈니스의 변화가 적을 경우 적절할 수 있다.

**단점**

- 외부 서비스 의존도가 낮은 비즈니스는 괜찮을 수 있다, 하지만 다양한/빈번한 외부 서비스 통신이 필요한 서비스에서는 제한적
    - 배달 중개 비즈니스가 생기는 변화를 통해, 배달 중개사와 배달원을 유동적으로 매칭해야 하는 상황이 온다면?
        - 배달 서비스는 단순 매칭이 아닌 적절한 배달 중개사/배달원 매칭을 효율적으로 해야하는 상황 발생
- Business Capability가 높은 MSA를 위해 서비스를 식별하여 분리/분해/통합 하는 목적에는 어려울 수 있다.

**‘비즈니스 동작 기반’ → 경우에 따라 높은 Business Capability를 가지기 어려운 상황이 발생 할 수 있다.**

### 하위 도메인 패턴을 기준으로 (from DDD)

- 비즈니스 동작 에서 도메인 모델을 중심으로 비즈니스 도메인에 초점을 맞추는 방식
- 도메인의 복잡성을 이해하고, 도메인의 문제를 해결하는 것에 집중하여 분리/분해의 기준으로 간주

**MSA에서의 하위 도메인을 이용한 분리/분해는 각 서비스의 Business Capability를 높이기 위해 필요에 따라 (하위)도메인(Sub-Domain)패턴별 분리/분해 하는 것이 목적!’**

하위 도메인 → 도메인 주도 설계(Domain - Driven Design, DDD) 에서 나온 개념

하위 도메인 ≠ 하위 도메인 패턴 100% 같은 내용이 아님

- 도메인 주도 설계는 소프트웨어를 디자인하는데 있어 설계 하는데 있어 개념,
    - 서비스를 식별하고 분해/통합 개념이 아님

### 하위 도메인을 기준으로 (from DDD)

- 비즈니스 동작 에서 문제영역(도메인)을 도출
- Business Capability를 위해 각 영역에서 집중해야 할 부분을 하위 도메인(Sub-Domain) 으로 식별하여 서비스로 도출

"주문 서비스" - 고객 입장
특정 음식점의 음식들을 주문할 수 있다.

→

"주문 접수"
주문을 "잘" 접수하는 것에 집중

- 비동기 통신 패턴(큐잉) 등의 스택에 집중

"주문 결제"
받은 주문에 대한 결제를 "잘"하는 것에 집중

- 외부 결제 모듈의 통신 or 낮은 수수료를 위한 방안 찾는 데 집중

"주문 단계에서의 추천"
주문 과정에서 "적절한" 방식으로 추가 상품 구매를 유도 집중

- AI/머신 러닝 활용으로 고객 별 최적화에 집중