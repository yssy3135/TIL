
### 옵티마이저

- MySQL 서버로 요청된 쿼리는 결과는 동일 내부적으로 어떻게 결과를 만들어낼지는 방법은 매우 다양
- 방법들 중에 어떤 방법이 최소 비용이 소모될지 결정해야한다.
- MySQL에서도 쿼리를 최적으로 실행하기 위해 각 테이블의 데이터가 어떤 분포로 저장되어 있는지 통계 정보를 참조하고 데이터를 비교해 최적의 실행 계획을 수립하는 작업이 필요. -> 이런 **작업을 옵티마이저가 담당**

**EXPLAIN 명령**
- 쿼리의 실행 계획을 알기위함.
- 상당히 많은 정보 출력


## 9.1.1 쿼리 실행 절차

**1. 사용자로부터 요청된 SQL 문장을 잘게 쪼개서 MySQL 서버가 이해할 수 있는 수준으로 분리 (파스 트리)**

- 이 과정을 SQL 파싱(Parsing) 이라고 함
- SQL 파서 라는 모듈로 처리
- SQL 파스 트리가 만들어지며, 파스 트리를 이용하여 쿼리를 실행한다.
- MySQL 엔진 처리

**2. SQL의 파싱 정보 (파스트리)를 확인하면서 어떤 테이블부터 읽고 어떤 인덱스를 이용해 테이블을 읽을지 선택 (최적화 및 계획 수립)**

- 불필요한 조건 제거 및 복잡한 연산 단순화
- 여러 테이블 조인 있는 경우 어떤 순서로 테이블을 읽을지 결정
- 각 테이블에 사용된 조건과 인덱스 통계 정보를 이용해 사용할 인덱스 결정
- 가져온 레코드들을 임시 테이블에 넣고 다시 한번 가공해야 하는지 결정 
- MySQL의 옵티마이저 에서 처리
- 이 단계가 끝나면 **실행 계획**이 만들어짐
- MySQL 엔진 처리


**3. 두번째 단계에서 결정된 테이블의 읽기 순서나 선택된 인덱스를 이용해 스토리지 엔진으로 부터 데이터를 가져온다.**

- 수립된 실행 계획대로 스토리지 엔진에 레코드를 읽어오도록 요청
- MySQL 엔진에서는 스토리지 엔진으로부터 받은 레코드를 조인하거나 정렬하는 작업 수행
- MySQL 엔진 및 스토리지 엔진 동시에 참여해 처리



## 옵티마이저의 종류

**비용 기반 최적화(Cost-bases optimizer, CBO) 방법**
- 현재 대부분 DBMS가 선택
- 여러가지 가능한 방법을 만들고 각 단위 작업의 비용(부하) 정보와 대상 테이블의 예측된 통계 정보를 이용해 실행 계획별 비용을 산출한다.
- 비용이 최소로 소요되는 처리 방식을 선택해 최종적으로 쿼리를 실행함.


**규칙 기반 최적화(Rule-based optimizer, RBO)**
- 예전 초기 버전 오라클 DBMS에서 많이 사용
- 기본적으로 대상 테이블의 레코드 건수나 선택도 등을 고려하지 않고 옵티마이저에 내장된 우선순위에 따라 실행 계획을 수립하는 방식을 의미.
- 통계 정보(테이블의 레코드 건수나 컬럼 값의 분포도)를 조사하지 않고 실행계획이 수립되기 때문에 같은 쿼리에 대해서는 거의 항상 같은 실행방법을 만들어냄
- 사용자의 데이터 분포도가 매우 다양하기 때문에 규칙 기반의 최적화는 이미 오래전부터 많은 DBMS에서 사용하지 않음.





