### 포인트컷 지시자

execution같은 포인터컷 지시자(Pointcut designator)로 시작한다. 줄여서 PCD

- AspectJ는 포인트컷을 편리하게 표현하기 위한 특별한 표현식을 제공

  ex) `@Pointcut(”execution(* hello.aop.order..*(..))”)`

- 포인트컷표현식은 AspectJ pointcut expression 즉 AspectJ가 제공하는 포인트컷 표현식을 줄여서 말하는 것.

********************************************************포인터컷 지시자의 종류********************************************************

- execution
    - 메소드 실행 조인 포인트를 매칭,
    - 스프링 AOP 에서 가장 많이 사용
    - ?는 생략 가능
    - * 같은 패턴을 지정 할 수 있다.
    - * 는 아무 값이나 들어와도 된다는 뜻.
    - .. 는 파라미터의 타입과 파라미터 수가 상관없다는 뜻.
    - 패키지에서 . , .. 차이를 이해해야 한다.

      . : 정확하게 해당 위치의 패키지

      .. : 해당 위치의 패키지와 그 하위 패키지도 포함

    - 부모 타입을 표현식에 선언한 경우 부모 타입에서 선언한 메서드가 자식 타입에 있어야 매칭에 성공한다.

![img_21.png](img%2Fimg_21.png)

- within

  특정 타입 내의 조인 포인트를 매칭

  해당 타입이 매칭되면 그 안의 메서드(조인 포인트) 들이 자동으로 매칭

  execution에서 타입 부분만 사용한다고 보면 된다.

    - execution과 차이
        - **표현식에 부모 타입을 지정하면 안된다, 정확하게 타입이 맞아야 한다. 이부분에서 execution과 차이**
- args

  인자가 주어진 타입의 인스턴스인 조인 포인트로 매칭

  문법은 execution의 args 부분과 같다.

    - **execution과 args의 차이**
        - execution은 파라미터 타입이 정확하게 매칭되어야 한다, 클래스에 선언된 정보를 기반으로 판다.
        - args는 부모 타입을 허용, 실제 넘어온 파라미터 객체 인스턴스를 보고 판단.
- this

  스프링 빈 객체(스프링 AOP 프록시)르 대상으로 하는 조인 포인트

- target

  Target 객체(스프링 AOP 프록시)를 대상으로 하는 조인 포인트

  this, target은 작용 타입 하나를 정확하게 지정해야 한다.

    ```java
    this(hello.aop.member.MemberService)
    target(hello.aop.member.MemberService)
    ```

    - *같은 패턴을 사용할 수 없다.
    - 부모타입을 허용한다.

  **this vs target**

  this : 스프링 빈으로 등록되어 있는 프록시 객체를 대상으로 포인트컷을 매칭

  target : 실제 target 객체를 대상으로 포인트컷을 매칭

  프록시를 대상으로 하는 this의 경우 구체 클래스를 지정하면 프록시 생성 전략에 따라 다른 결과가 나올 수도 있다.

- @target

  Target 객체(스프링 AOP 프록시가 가르키는 실제 대상)를 대상으로 하는 조인 포인트

- @within

  주어진 애노테이션이 있는 타입 내 조인 포인트

  **@target vs @within**

  @target은 인스턴스 모든 메서드를 조인 포인트로 적용, 부모 클래스의 메서드까지 어드바이스를 다 적용

  @within은 해당 타입 내에 있는 메서드만 조인 포인트로 적용, 자기 자신의 클래스에 정의된 메서드에만 어드바이스 적용

![img_22.png](img%2Fimg_22.png)

- @annotation

  메서드가 주어진 애노테이션을 가지고 있는 조인 포인트를 매칭

- @args

  전달된 실제 인수의 런타임 타입이 주어진 타입의 애노테이션을 갖는 조인 포인트

- bean

  스프링 전용 포인트컷 지시자, 빈의 이름으로 포인트컷을 지정

  bean(orderService) || bean(*Repository)

  *과같은 패턴을 사용할 수 있다.


************포인트컷 지시자는 단독으로 사용하지 말자. (arg,@args,@target)************

- arg, @args, @target은 실제 객체 인스턴스가 생성되고 실행될 때 어드바이스 적용 여부를 확인 할 수 있다.
- 실행시점에 일어나는 포인트컷 적용 여부도 프록시가 있어야 실행 시점에 판단 할 수 있다.
- 프록시가 없다면 판단 자체가 불가능하다.
- 스프링 컨테이너가 프록시를 생성하는 시점은 스프링 컨테이너가 만들어지는 애플리켕션 로딩 시점에 적용할 수 있다.
- args, @args, @target같은 포인트컷 지시자가 있으면  스프링은 모든 스프링 빈에 AOP를 적용하려고 시도한다.
- 하지만 프록시가 없으면 실행 시점에 판단 불가
- 문제는 이때 모든 스프링 빈에 AOP 프록시를 적용하려고 하면 스프링이 사용하는 빈 중에 final로 지정된 빈들도 있기 때문에 오류가 발생
- 최대한 프록시 적용 대상을 축소하는 표현식과 함께 사용해야 한다.

### 매개변수 전달

포인트컷 표현식을 사용해서 어드바이스에 매개변수를 전달할 수 있다.

this, target, args, @target, @within, @annotation, @args

```java
@Before("allMember() && args(arg,..)")
  public void logArgs3(String arg) {
      log.info("[logArgs3] arg={}", arg);
  }
```

- 포인트컷의 이름과 매개변수의 이름을 맞추어야 한다.
- 추가로 타입이 메서드에 지정한 타입으로 제한된다.