# [스프링] 3. 템플릿 메서드 패턴과 콜백 패턴

example code -  branch. section3

### 핵심 기능과 부가기능

- ******************핵심기능******************

  해당 객체가  제공하는 고유의 기능 orderService의 핵심은 주문 로직.

  메서드 단위로 보면 orderService.orderItem()의 핵심 기능은 주문 데이터를 저장하기 위해 리포지토리를 호출하는 orderRepository.save(itemId)코드가 핵심 기능

- ******************부가 기능******************

  핵심 기능을 보조하기 위해 제공되는 기능 예를들어 로그 추적, 트랜잭션 기능

  이런 부가 기능은 단독으로 사용되지 않고 핵심기능과 함께 사용된다.


### 변하는 것과 변하지 않는 것을 분리해라.

******************템플릿 메서드******************

- 좋은 설계는 변하는 것과 변하지 않는 것을 분리하는 것!
- 템플릿 메서드 패턴은 이름 그대로 템플릿을 사용.
- 템플릿은 기준이 되는 거대한 틀.
- 부모 클래스에 변하지 않는 템플릿 코드를 두고 변하는 부분을 자식 클래스에 두고 상속과 오버라이딩을 사용해서 처리한다.
- 다형성을 사용해서 변하는 부분과 변하지 않는 부분을 분리하는 방법
- 이렇게 하면 자식 클래스가 알고리즘의 전체 구조를 변경하지 않고, 특정 부분만 재정의 할 수 있다.

![img_5.png](img%2Fimg_5.png)

### 단점

- 템플릿 메서드 패턴은 상속을 사용
  따라서 상속에서 오는 단점들을 그대로 안고간다.
- 특히 자식 클래스가 부모 클래스와 컴파일 시점에 강하게 결합되는 문제가 있다.
- 상속을 받는다는 것은 특정 부모 클래스를 의존하고 있다는 것.
- 따라서 부모 클래스의 기능을 사용하든 사용하지 않는 간에 부모 클래스를 강하게 의존하게 된다.
- 강하게 의존한다는 뜻은 자식 클래스의 코드에 부모 클래스의 코드가 명확하게 적혀있다는 뜻.

추가로 템플릿 메서드 패턴은 상속 구조를 사용하기 때문에 별도의 클래스나 익명 내부 클래스를 만들어야 하는 부분도 복잡하다.

### 좋은 설계란?

진정한 좋은 설계는 변경이 일어날 대 자연스럽게 드러난다.

단일 책임 원칙(SRP)

변경 지점을 하나로 모아서 변경에 쉽게 대처할 수 있는 구조를 만든 것.

## 전략 패턴(Strategy Pattern)

************************************************************************************************************************************************************************************************************************************템플릿 메서드 패턴과 비슷한 역할을 하면서 상속의 단점을 제거할 수 있는 디자인 패턴.************************************************************************************************************************************************************************************************************************************

- 템플릿 메서드 패턴은 부모 클래스에 변하지 않는 템플릿을 두고, 변하는 부분을 자식 클래스에 두어서 상속을 사용해 문제를 해결.
- 전략 패턴은 변하는 부분에 인터페이스를 만들고 해당 인터페이스를 구현하도록 해서 문제를 해결.
- 상속이 아니라 위임으로 문제를 해결하는 것.
- 스프링에서 의존관계 주입에서 사용하는 방식이 바로 전략 패턴
- 
![img_6.png](img%2Fimg_6.png)

### 템플릿

해결하고 싶은 문제는 변하는 부분과 변하지 않는 부분을 분리하는 것.

변하지 않는 부분을 템플릿이라 하고, 그 템플릿 안에서 변하는 부분에 약간 다른 코드 조각을 넘겨서 실행하는 것이 목적.

## 템플릿 콜백 패턴

- 템플릿 역할을 하는 변하지 않는 로직과 , 변하는 부분을 파라미터로 넘어온 코드를 실행해서 처리
- 다른 코드의 인수로서 넘겨주는 실행 가능한 코드를 콜백(callback 이라고 한다.)
- 템플릿 콜백 패턴은 GOF 패턴은 아니고, 스프링 내부에서이런 방식을 자주 사용하기 때문에, 스프링 안에서만 이렇게 부른다.
- 전략 패턴에서 템플릿과 콜백 부분이 강조된 패턴이라 생각하면 된다.

> 콜백이란?
콜백(callback) 콜애프터 함수(call-after function)는 다른 코드의 인수로서 넘겨주는 실행 가능한 코드를 말함.
콜백을 넘겨받는 코드는 이 콜백을 필요에 따라 즉시 실행할 수도, 나중에 실행할 수도 있다.
>

쉽게 이야기해, 코드가 호출(call)은 되는데 코드를 넘겨준 곳의 뒤(back)에서 실행된다는 뜻.

![img_7.png](img%2Fimg_7.png)

별도의 클래스를 만들어서 전달해도 되지만, 콜백을 사용할 경우 익명 내부 클래스나 람다를 사용하는 것이 편리.

**한계**

템플릿 메서드 패턴, 전략패턴, 템플릿 콜백 패턴까지 변하는 코드와 변하지 않는 코드를 분리했다.

그리고 템플릿콜백 패턴을 적용하고 콜백으로 람다를 사용해서 코드 사용도 최소화 할 수 있었다.

**하지만 지금까지 설명한 방식의 한계는 아무리 최적화를 해도 결국 원본 코드를 수정해야 한다는 점이다.**


출처 : 인프런 스프링 aop 고급편